+++
date = 2025-04-30
title = "Настройка клавиатуры в ZMK keymap-editor"
tags = ["guide", "zmk"]
+++

ZMK keymap-editor - это мощный инструмент для настройки клавиатуры, позволяющий удобно и быстро воплотить идею в готовую раскладку. 
В статье описана процедура подключения keymap-editor и основные возможности с точки зрения как нового пользователя, только начинающего погружение в мир сплит-клавиатур, так и уже знакомого с сплит-клавиатурами и настройкой раскладки в Vial.

## Начало работы с ZMK keymap-editor

Keymap-editor является веб-приложением, он доступен из браузера по адресу https://nickcoutsos.github.io/keymap-editor/.
Чтобы им воспользоваться есть несколько пререквизитов:
1) Пользователь должен быть зарегистрирован на https://github.com/
2) Пользователю нужен форк репозитория https://github.com/danil-tolkachev/zmk-test 





Не забыть про: 
1) Перетаскивание слоев (тут стоит отметить что у комбо могут сбиваться ограничения по слоям, рассказ после комбо)
2) Наименования слоев
ZMK еще круче виала в том плане, что ты можешь слои обозвать, вот как у меня диктор например, так проще ориентироваться, чем по безымянным индексам. Тоже самое и с комбо, макросами, модтапами. Всему можно навесить название, как тебе удобно.
Комбо кстати тоже порадовали, можно выбирать на каких слоях оно будет активно. Ну тебя этим не удивлю, насколько помню в канате такое есть)
3) Мод-тапы, то что можно сделать свой Behavior, в который на тап и на холд можно назначить любое действие например макрос. С помощью этого же трюка, можно сделать кастомные тайминги для каждого пальца при использовании HRM
2) Именные макросы, параметризованные макросы (трюк с уменьшением wait до 0 в коде)


В теории ты можешь тут сделать так, чтобы модтап активировался только с зажатым модификатором (не знаю зачем, но можешь!)

/Users/ivans/Library/Containers/ru.keepcoder.Telegram/Data/tmp/telegram-cloud-photo-size-2-5215545119187528628-y.jpg

Не, в key overrides нельзя класть кучу вещей, например слоефикаторы, макросы. Это основной минус виаловских оверрайдов.
И в key overrides ты объявляешь глобальное правило на слой, а тут этот Mod morph надо назначить на конкретную клавишу в кеймапе.




// RuEn

Задача состоит лишь в том, чтобы клавиатура знала какой сейчас у тебя в ОС язык. Добиться этого можно следующим образом: для переключения языка пилим макрос, включающий слой нужного языка, и отправляющий коды сочетания клавиш для переключения языка в ОС. 

Теперь, когда ты переключаешь язык - у тебя и переключается на соответствующий слой, например русского языка.

Пилим отдельный символьный слой для русского, на этом слое, чтобы реализовать "RuEn &" мы пилим макрос, делающий следующее:
1) Отправляет в ОС сочетание для переключения языка на инглиш
2) Жмакает клавишу LShift(KL_7)
3) Отправляет в ОС сочетание для переключения обратно на русский.

Все, задача решена. Никакого влезания в код, все чисто на слоях.

Такой подход отлично работает с режимом "M1M2", то есть у меня есть отдельное сочетание для включения русского и английского, и в макросе переключения на слой я пользуюсь DF(), для принудительного выбора нужного мне слоя. 
Подход со стандартным "тогглом" тоже вполне реализуем, пилим макрос жмакающий TG(слой для русского), и отправляющий Win + Space. Тут стоит сделать и отдельный макрос для синхронизации, как это сделано в RuEn.

Ну, макрос для тоггла же тоже можно реализовать, в чем проблема.
Ну смотри, в RuEn есть клавиша RuEn Sync, она просто тогглит Ru/En в памяти клавы. Жмакаешь ты ее, если произошел рассинхрон. Применим тот же подход - добавляем себе клавишу TG(слой для русского), и жмакаем ее, когда произошел рассинхрон, чтобы клавиатуре сказать, что сейчас другой язык.
TG() в данном случае переключит слой в клаве, и текущий активный слой по сути будет говорить клаве о том, какой сейчас в ОС язык.


Про крутецкий капс ворд